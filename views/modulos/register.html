{{extend 'layout.html'}}

{{block center}}
<!-- Bloque de navegación secundaria (breadcrumb) -->
<nav class="navbar navbar-inverse navbar-fixed-top breadcrumbs">
  <div class="breadcrumb">
  <a class="breadcrumb-item" href="{{=URL('..', 'sigulab2', 'modulos')}}">Inicio</a>
  <a class="breadcrumb-item" href="#">Gestión</a>
  <span class="breadcrumb-item active">Registrar Usuario</span>
  </div>
</nav>
<!-- Fin del bloque de navegación secundaria (breadcrumb) -->

<div class="col-sm-4">
</div>

<div class="col-sm-4">
<!-- Inicio Wrapper -->
    <div class="wrapper-page pagina">

        <!-- Inicio card box -->
        <div id="boxRegister" class="m-t-40 card-box boxes">
            <div class="text-center">
                <h4 id="titulo" class="text-uppercase font-bold m-b-0">Nuevo Usuario</h4>
            </div>
            
            <!-- Inicio panel -->
            <div class="panel-body">

            <!-- Inicio form de registro -->
            <form action="#" class="form-horizontal form-horizontal m-t-20" enctype="multipart/form-data" method="post">

                <!-- Nombre -->
                <div class="form-group" id="auth_user_first_name__row">
                    <div class="col-xs-12">
                        <input class="form-control string" id="auth_user_first_name" name="first_name" type="text" placeholder="Nombre" value="" required>
                        <span class="help-block"></span>
                    </div>
                </div>

                <!-- Apellido -->
                <div class="form-group" id="auth_user_last_name__row">
                    <div class="col-xs-12">
                        <input class="form-control string" id="auth_user_last_name" name="last_name" type="text" placeholder="Apellido" value="" required>
                        <span class="help-block"></span>
                    </div>
                </div>

                <!-- Cedula de Identidad -->
                <div class="form-group" id="auth_cedula__row">
                    <div class="col-xs-12">
                        <input class="form-control number" id="cedula" name="cedula" type="text" placeholder="Cedula" required>
                        <span class="help-block"></span>
                    </div>
                </div>


                <!-- Email -->
                <div class="form-group" id="auth_user_email__row">
                    <div class="col-xs-12">
                        <input class="form-control string" id="auth_user_email" name="email" type="text" placeholder="Correo Electrónico" value="" required>
                        <span class="help-block"></span>
                    </div>
                </div>

                <!-- Contraseña -->
                <div class="form-group" id="auth_user_password__row">
                    <div class="col-xs-12">
                        <input class="form-control password" id="auth_user_password" name="password" type="password" placeholder="Contraseña" value="" required>
                        <span class="help-block"></span>
                    </div>
                </div>

                <!-- Confirmar contraseña --> 
                <div class="form-group" id="auth_user_password_two__row">
                    <div class="col-xs-12">
                        <input class="form-control password" id="auth_user_password_two" name="password_two" type="password" placeholder=" Confirmar Contraseña" value="" required>
                        <span class="help-block"></span>
                    </div>
                </div>

                <!-- Tipos de Rol -->
                <div class="form-group">
                    <div class="col-xs-12">
                        <select class="form-control" type="select" required="" id="rol" name="rol" placeholder="Rol" onchange="getUnidad(); getSeccion();">
                            <option value="" selected hidden disabled>Rol</option>
                            {{for rol in roles:}}
                            <option value='{{=rol.id}}'>{{=rol.role}}</option>
                            {{pass}}
                        </select>
                    </div>
                </div>

                <div id="unidaddiv" class="form-group"></div>

                <div id="secciondiv" class="form-group"></div>

                <div class="form-group text-center m-t-40" id="submit_record__row">

                    <div class="col-sm-3">
                        <a class="btn btn-primary" href="{{=URL('index')}}">Cancelar</a>
                    </div>

                    <div class="col-sm-6">
                    </div>

                    <div class="col-sm-3" onclick="setMembership();">
                        <button class="btn btn-primary" type="submit" name="registrar" value="do_register">Registrar</button>
                    </div>
                </div>

            </form>
            <!-- Fin form de registro -->
            </div>
            <!-- Fin Panel -->
        </div>
        <!-- Fin card-box -->
    </div>
<!-- Fin Wrapper -->
</div>
<div class="col-sm-4">
</div>

<input type="hidden" id="dependenciahidden" name="dependenciahidden" value="">
<input type="hidden" id="seccionhidden" name="seccionhidden" value="">


<script language="javascript" src="{{=URL('static', 'js/jquery.js')}}"></script>
<script language="javascript" src="{{=URL('static', 'js/web2py.js')}}"></script>
<script language="javascript">
    function setMembership(){
        console.log('cedula')
        ajax('ajax_membership', ['laboratorio', 'rol', 'seccion','cedula'], 'hiddendiv');
    }

    function getUnidad(){
        var opcionesrol = document.getElementById("rol");
        var rolelegida = opcionesrol.options[opcionesrol.selectedIndex].value;
        var x = document.getElementById("dependenciahidden");
        x.value = rolelegida;

        ajax('ajax_unidad_rol', ['dependenciahidden'], 'unidaddiv');
    }

    function getSeccion(){
        var opcionesrol = document.getElementById("rol");
        var rolelegida = opcionesrol.options[opcionesrol.selectedIndex].value;
        var opcioneslab = document.getElementById("laboratorio");
        var labelegido = opcioneslab.options[opcioneslab.selectedIndex].value;
        var x = document.getElementById("dependenciahidden");
        x.value = rolelegida;
        var x = document.getElementById("seccionhidden");
        x.value = labelegido;
        ajax('ajax_registro_seccion', ['dependenciahidden', 'seccionhidden'], 'secciondiv');
    }

</script>
{{end}}
