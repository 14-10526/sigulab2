{{extend 'layout.html'}}
  
{{block head}}
	<meta charset="UTF-8">

	<!-- Para los mensajes con flash -->
  	<link rel="stylesheet" href="{{=URL('static','css/web2py-bootstrap3-flash.css')}}"/>

 	<!-- DataTables -->
 	<link href="{{=URL('static', 'plugins/datatables/jquery.dataTables.min.css')}}" rel="stylesheet" type="text/css" />
 	<link href="{{=URL('static', 'plugins/datatables/buttons.bootstrap.min.css')}}" rel="stylesheet" type="text/css" />
 	<link href="{{=URL('static', 'plugins/datatables/responsive.bootstrap.min.css')}}" rel="stylesheet" type="text/css" />	
 	
 	<!-- Estilos de modales y listados -->
 	<link rel="stylesheet" type="text/css" href="{{=URL('static', 'css/smydp_modal.css')}}">
 	<link rel="stylesheet" href="{{=URL('static', 'css/smydp_listado.css')}}">
  <link rel="stylesheet" href="{{=URL('static', 'css/smydp_bitacora.css')}}">
 	<link rel="stylesheet" href="{{=URL('static', 'css/smydp_template_modal.css')}}">	  
 	<script src="{{=URL('static', 'js/smydp_template_modal.js')}}"></script>	
 	<!-- Web2py JS - Especialmente para AJAX -->
 	<script src="{{=URL('static', 'js/web2py.js')}}"></script>
 	<style>
   	.row{
     	margin-right:0px!important;
   	}
 	</style>
{{end}}

{{block center}}

<!-- Breadcrumb de navegación -->
<nav class="navbar navbar-inverse navbar-fixed-top breadcrumbs">
  <div class="breadcrumb">
	  <a class="breadcrumb-item" href="{{=URL('..', 'sigulab2')}}">Inicio</a>
	  <a class="breadcrumb-item" href="{{=URL('..', 'sigulab2', 'smydp')}}">SMyDP</a>
	  <a class="breadcrumb-item" href="{{=URL('..', 'sigulab2', 'smydp/sustancias')}}">SyM</a>
	  <a class="breadcrumb-item active" href="{{=URL('..', 'sigulab2', 'smydp/inventarios')}}">Inventarios</a>
    <a class="breadcrumb-item active" href="{{=URL('..', 'sigulab2', 'smydp/inventarios', vars=dict(dependencia=espacio_id, es_espacio='True'))}}">{{=espacio_nombre}}</a>
	  <span class="breadcrumb-item active">Bitácora</span>
  </div>
</nav>
<!-- Fin del Breadcrumb de navegación --> 

<!-- Inicio Listado de sustancias -->
<div class="container">
<div class="row">
  <div>
    <h3 id="titulo" class="titulos"> Bitácora</h3>
    <h3 id="subtitulo" class="titulos"> {{=sust_nombre}} ({{=espacio_nombre}})</h3>
  </div>
    <div id="buttons">
      <!-- Filtrado -->
        <button type="button" id="filtrar" onclick="mostrarFiltro()" class="btn btn-default buttons-pdf buttons-html5">Filtrado</button>
      <!-- Filtrado -->    
    </div>
    <br>

    <div class="table-responsive no-padding no-margin">
      <table id="datatable" class="table table-hover table-striped dt-responsive display tablaListado" cellspacing="0" width="100%">
        <thead>
            <tr id="titulosListado">
                <th class="camposTabla linksNombres">Fecha</th>
                <th class="camposTabla linksNombres">Responsable</th>
                <th class="camposTabla linksNombres">Concepto</th>
                <th class="camposTabla linksNombres">Cantidad</th>
                <th class="camposTabla linksNombres">Unidad</th>
                <th class="camposTabla linksNombres">Descripción</th>
            </tr>
        </thead>

        <tbody>
          {{for registro in bitacora:}}
            {{auth_user = registro['auth_user']}}
            {{reg = registro['t_Bitacora']}}
            {{usuario = registro['t_Personal']}}
            {{medida = registro['t_Unidad_de_medida']}}
            <tr>
                <td class="camposTabla">{{=reg.created_on}}</td>
                <td class="camposTabla">{{=usuario.f_nombre}} {{=usuario.f_apellido}}</td>
                <td class="camposTabla">{{=reg.f_concepto[0]}}</td>
                {{if reg.f_concepto[0] == 'Ingreso':}}
                  <th class="camposTabla">{{=reg.f_cantidad}}</th>
                {{else:}}
                  <th class="camposTabla">-{{=reg.f_cantidad}}</th>
                {{pass}}
                <th class="camposTabla">{{=medida.f_nombre}}</th>
                <td class="camposTabla">__mostrar_descripcion(registro)</td>
            </tr>
          {{pass}}
        </tbody>

        <tfoot id="collapseFiltros">
            <tr>
                <th class="camposTabla linksNombres">Fecha</th>
                <th class="camposTabla linksNombres">Responsable</th>
                <th class="camposTabla linksNombres">Concepto</th>
                <th class="camposTabla linksNombres">Cantidad</th>
                <th class="camposTabla linksNombres">Unidad</th>
                <th class="camposTabla linksNombres">Descripción</th>
            </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>  
<!-- Fin Listado de sustancias -->
{{end}}

<script>
  // Set blue bar below INICIO text.
  document.getElementById("smydp").className += " active";
  }
</script>

<!-- Datatables-->
<script src="{{=URL('static', 'plugins/datatables/jquery.dataTables.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/dataTables.bootstrap.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/dataTables.buttons.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/buttons.bootstrap.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/jszip.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/pdfmake.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/vfs_fonts.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/buttons.html5.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/buttons.print.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/dataTables.responsive.min.js')}}"></script>
<script src="{{=URL('static', 'plugins/datatables/responsive.bootstrap.min.js')}}"></script>



<!-- Datatable init js -->
<script src="{{=URL('static', 'plugins/datatables/datatables.init.js')}}"></script>
<script>

  var filtros = false;

  $(document).ready(function() {
      // Setup - add a text input to each footer cell
      $('#datatable tfoot th').each( function () {
          var title = $(this).text();
          $(this).html( '<input type="text" placeholder="Filtro" />' );
      } );
   
      // DataTable
      var table = $('#datatable').DataTable();
   
      // Apply the search
      table.columns().every( function () {
          var that = this;
   
          $( 'input', this.footer() ).on( 'keyup change', function () {
              if ( that.search() !== this.value ) {
                  that
                      .search( this.value )
                      .draw();
              }
          } );
      } );

      $('#datatable tfoot tr').appendTo('#datatable thead');
      $("#datatable thead tr").not("#titulosListado").css("display","none");
  } );

  function mostrarFiltro() {
      if (filtros){
        $("#datatable thead tr").not("#titulosListado").css("display","none");
        filtros = false
      }
      else{
        $("#datatable thead tr").not("#titulosListado").css("display","table-row");
        filtros = true
      }

  }
</script>


<script language="javascript">
/*
  var table = $('#datatable').DataTable({
    language: {
      url: "{{=URL('static', 'plugins/datatables/l18n/es-ES.json')}}"
    },
   initComplete: function(){
      var api = this.api();

      new $.fn.dataTable.Buttons(api, {
         buttons: [
            'copy', 'pdf', 'excel', 'csv', 'print'
         ]
      });
      api.buttons().container().appendTo('#buttons');  
   }
  });

  var w2p_ajax_confirm_message =
        "{{=T('')}}";
  
  // AJAX mostrar ficha de sustancia
  function abrirFicha(sustancia) {
    var x = document.getElementById("sust");
    x.value = sustancia;
    ajax('ajax_ficha_sustancia', ['sust'], "ficha");
  }
*/

</script> 

{{end}}